"use strict";(globalThis["webpackChunkiotapp"]=globalThis["webpackChunkiotapp"]||[]).push([[109],{8109:(e,t,l)=>{l.r(t),l.d(t,{default:()=>le});var a=l(1758),i=l(8790),s=l(9104);const o={class:"row q-pa-md"},d={class:"col"},n={class:"text-subtitle1 text-white"},r={class:"row q-pa-md"},u={class:"q-ml-md"},c={class:"text-h6 text-white"},m={class:"text-substitle text-white"},p={class:"row q-gutter-sm"},h={class:"row q-gutter-sm q-mt-sm"},v={key:0},g={key:0,style:{height:"300px","margin-top":"16px"}},b={key:1,class:"text-negative q-mt-md"},f={class:"q-gutter-md"},k={class:"q-mt-md row justify-end"},_={class:"row q-pa-md"},y={class:"col"},w={class:"text-subtitle1 text-white"},x={class:"row q-gutter-sm"},D={class:"row q-pa-md"},L={class:"q-ml-md"},F={class:"text-h6 text-white"},q={class:"text-substitle text-white"},V={class:"row q-gutter-sm"},C={key:0},A={key:0,style:{height:"300px","margin-top":"16px"}},E={key:1,class:"text-negative q-mt-md"},z={key:0},S={key:1},T={class:"q-gutter-md"},$={class:"q-mt-md row justify-end"};function U(e,t,l,U,I,W){const M=(0,a.g2)("q-btn"),Q=(0,a.g2)("q-card"),X=(0,a.g2)("q-icon"),O=(0,a.g2)("q-badge"),N=(0,a.g2)("l-tile-layer"),B=(0,a.g2)("l-marker"),J=(0,a.g2)("l-map"),H=(0,a.g2)("q-card-section"),P=(0,a.g2)("q-card-actions"),R=(0,a.g2)("q-dialog"),Y=(0,a.g2)("q-input"),K=(0,a.g2)("q-select"),j=(0,a.g2)("q-form"),G=(0,a.g2)("q-page"),Z=(0,a.g2)("q-table"),ee=(0,a.gN)("close-popup");return e.$q.platform.is.mobile?((0,a.uX)(),(0,a.Wv)(G,{key:0,class:"q-pa-md bg-black"},{default:(0,a.k6)(()=>[t[27]||(t[27]=(0,a.Lk)("p",{class:"textt text-white text-h4"},"Devices",-1)),(0,a.bF)(Q,{class:"cardd q-mb-md bg-negative"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",o,[(0,a.Lk)("div",d,[t[19]||(t[19]=(0,a.Lk)("div",{class:"text-h6 text-white"},"Device page",-1)),t[20]||(t[20]=(0,a.Lk)("p",{class:"text-white text-caption"}," You can see all your registered devices here ",-1)),(0,a.Lk)("div",n,[(0,a.bF)(M,{label:"Add device",type:"button",to:"add_device",color:"dark",unelevated:"",class:"full-width button-cuy text-capitalize text-white"})])])])]),_:1}),t[28]||(t[28]=(0,a.Lk)("p",{class:"textt text-white text-h6"},"Your devices",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(I.devices,e=>((0,a.uX)(),(0,a.Wv)(Q,{class:"cardd q-mb-md bg-dark q-pa-md",key:e.mac_address},{default:(0,a.k6)(()=>[(0,a.Lk)("div",r,[(0,a.bF)(O,{class:"badge q-pa-md",color:"negative"},{default:(0,a.k6)(()=>[(0,a.bF)(X,{class:"col-2",size:"50px",name:"local_fire_department",color:"white"})]),_:1}),(0,a.Lk)("div",u,[(0,a.Lk)("div",c,(0,i.v_)(e.device_name),1),(0,a.Lk)("div",m,(0,i.v_)(e.mac_address),1),(0,a.bF)(O,{color:"green"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(e.status),1)]),_:2},1024)])]),(0,a.Lk)("div",p,[(0,a.bF)(M,{label:"Edit",type:"button",color:"green-8",unelevated:"",class:"col button-cuy text-capitalize text-white",onClick:t=>W.openEditDialog(e)},null,8,["onClick"]),(0,a.bF)(M,{label:"Delete",type:"button",color:"negative",unelevated:"",class:"col button-cuy text-capitalize text-white",onClick:t=>W.confirmDeleteDevice(e.mac_address,e.user_id)},null,8,["onClick"])]),(0,a.Lk)("div",h,[(0,a.bF)(M,{label:"See details",type:"button",color:"primary",unelevated:"",class:"col button-cuy text-capitalize text-white",onClick:t=>W.goToDetailPage(e.mac_address)},null,8,["onClick"])])]),_:2},1024))),128)),(0,a.bF)(R,{modelValue:I.detailDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>I.detailDialog=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{class:"bg-dark text-white",style:{"min-width":"400px","max-width":"600px"}},{default:(0,a.k6)(()=>[(0,a.bF)(H,null,{default:(0,a.k6)(()=>[t[25]||(t[25]=(0,a.Lk)("div",{class:"text-h6"},"Detail Device",-1)),I.selectedDevice?((0,a.uX)(),(0,a.CE)("div",v,[(0,a.Lk)("div",null,[t[21]||(t[21]=(0,a.Lk)("strong",null,"Device Name:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.device_name),1)]),(0,a.Lk)("div",null,[t[22]||(t[22]=(0,a.Lk)("strong",null,"MAC Address:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.mac_address),1)]),(0,a.Lk)("div",null,[t[23]||(t[23]=(0,a.Lk)("strong",null,"Topic:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.topic),1)]),(0,a.Lk)("div",null,[t[24]||(t[24]=(0,a.Lk)("strong",null,"Current Data:",-1)),(0,a.eW)(" "+(0,i.v_)(W.getTemperature(I.selectedDevice.data))+" °C ",1)]),W.hasLocation?((0,a.uX)(),(0,a.CE)("div",g,[(0,a.bF)(J,{zoom:I.zoom,center:W.mapCenter,style:{height:"100%",width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),(0,a.bF)(B,{"lat-lng":W.mapCenter},null,8,["lat-lng"])]),_:1},8,["zoom","center"])])):((0,a.uX)(),(0,a.CE)("div",b," Lokasi tidak tersedia (latitude/longitude kosong). "))])):(0,a.Q3)("",!0)]),_:1,__:[25]}),(0,a.bF)(P,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bo)((0,a.bF)(M,{flat:"",label:"Close",color:"white"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(R,{modelValue:I.showEditDialog,"onUpdate:modelValue":t[8]||(t[8]=e=>I.showEditDialog=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{style:{"min-width":"400px","max-width":"600px"},class:"bg-dark"},{default:(0,a.k6)(()=>[(0,a.bF)(H,null,{default:(0,a.k6)(()=>t[26]||(t[26]=[(0,a.Lk)("div",{class:"text-h6 text-white"},"Edit Device",-1)])),_:1,__:[26]}),(0,a.bF)(H,null,{default:(0,a.k6)(()=>[(0,a.bF)(j,{onSubmit:(0,s.D$)(W.submitEdit,["prevent"]),ref:"formRef",class:"col"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",f,[(0,a.bF)(Y,{outlined:"",dense:"",modelValue:I.form.mac_address,"onUpdate:modelValue":t[1]||(t[1]=e=>I.form.mac_address=e),label:"MAC Address","label-color":"white",class:"white-outline",readonly:"","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue"]),(0,a.bF)(Y,{outlined:"",dense:"",modelValue:I.form.device_name,"onUpdate:modelValue":t[2]||(t[2]=e=>I.form.device_name=e),label:"Device Name","label-color":"white",rules:[e=>!!e||"Device name is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(K,{outlined:"",dense:"",modelValue:I.form.device_types_id,"onUpdate:modelValue":t[3]||(t[3]=e=>I.form.device_types_id=e),options:I.deviceTypes,label:"Device Type","label-color":"white",class:"white-outline text-white","input-class":"text-white",color:"white","option-label":"type_name","option-value":"id_device_types","emit-value":"","map-options":"",clearable:"",rules:[e=>null!==e||"Device type is required"],"option-class":"text-white","popup-content-class":"bg-grey-10"},null,8,["modelValue","options","rules"]),(0,a.bF)(Y,{outlined:"",dense:"",type:"number",modelValue:I.form.latitude,"onUpdate:modelValue":t[4]||(t[4]=e=>I.form.latitude=e),modelModifiers:{number:!0},label:"Latitude","label-color":"white",rules:[e=>null!==e&&void 0!==e||"Latitude is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(Y,{outlined:"",dense:"",type:"number",modelValue:I.form.longitude,"onUpdate:modelValue":t[5]||(t[5]=e=>I.form.longitude=e),modelModifiers:{number:!0},label:"Longitude","label-color":"white",rules:[e=>null!==e&&void 0!==e||"Longitude is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(K,{outlined:"",dense:"",modelValue:I.form.status,"onUpdate:modelValue":t[6]||(t[6]=e=>I.form.status=e),options:I.statusOptions,label:"Status","label-color":"white",class:"white-outline","input-class":"text-white",color:"white",rules:[e=>!!e||"Status is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),(0,a.bo)((0,a.Lk)("input",{type:"hidden","onUpdate:modelValue":t[7]||(t[7]=e=>I.form.user_id=e)},null,512),[[s.Jo,I.form.user_id]])]),(0,a.Lk)("div",k,[(0,a.bo)((0,a.bF)(M,{flat:"",label:"Cancel",color:"red",onClick:W.closeEditDialog},null,8,["onClick"]),[[ee]]),(0,a.bF)(M,{label:"Save",type:"submit",color:"green",loading:I.loading,unelevated:""},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[27,28]})):((0,a.uX)(),(0,a.Wv)(G,{key:1,class:"q-pa-md bg-black"},{default:(0,a.k6)(()=>[t[42]||(t[42]=(0,a.Lk)("p",{class:"textt text-white text-h4"},"Devices",-1)),(0,a.bF)(Q,{class:"cardd q-mb-md bg-negative"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",_,[(0,a.Lk)("div",y,[t[29]||(t[29]=(0,a.Lk)("div",{class:"text-h6 text-white"},"Device page",-1)),t[30]||(t[30]=(0,a.Lk)("p",{class:"text-white text-caption"}," You can see all your registered devices here ",-1)),(0,a.Lk)("div",w,[(0,a.bF)(M,{label:"Add device",type:"button",to:"add_device",color:"dark",unelevated:"",class:"full-width button-cuy text-capitalize text-white"})])])])]),_:1}),t[43]||(t[43]=(0,a.Lk)("p",{class:"textt text-white text-h6"},"Your devices",-1)),(0,a.Lk)("div",x,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(I.devices,e=>((0,a.uX)(),(0,a.Wv)(Q,{class:"cardd q-mb-md bg-dark q-pa-md",key:e.mac_address},{default:(0,a.k6)(()=>[(0,a.Lk)("div",D,[(0,a.bF)(O,{class:"badge q-pa-md",color:"negative"},{default:(0,a.k6)(()=>[(0,a.bF)(X,{class:"col-2",size:"50px",name:"local_fire_department",color:"white"})]),_:1}),(0,a.Lk)("div",L,[(0,a.Lk)("div",F,(0,i.v_)(e.device_name),1),(0,a.Lk)("div",q,(0,i.v_)(e.mac_address),1),(0,a.bF)(O,{color:"green"},{default:(0,a.k6)(()=>[(0,a.eW)((0,i.v_)(e.status),1)]),_:2},1024)])]),(0,a.Lk)("div",V,[(0,a.bF)(M,{label:"Edit device",type:"button",color:"green-8",unelevated:"",class:"col button-cuy text-capitalize text-white",onClick:t=>W.openEditDialog(e)},null,8,["onClick"]),(0,a.bF)(M,{label:"See details",type:"button",color:"primary",unelevated:"",class:"col button-cuy text-capitalize text-white",onClick:t=>W.goToDetailPage(e.mac_address)},null,8,["onClick"])]),t[31]||(t[31]=(0,a.Lk)("div",{class:"row q-gutter-sm q-mt-sm"},null,-1))]),_:2,__:[31]},1024))),128))]),(0,a.bF)(R,{modelValue:I.detailDialog,"onUpdate:modelValue":t[9]||(t[9]=e=>I.detailDialog=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{class:"bg-dark text-white",style:{"min-width":"400px","max-width":"600px"}},{default:(0,a.k6)(()=>[(0,a.bF)(H,null,{default:(0,a.k6)(()=>[t[36]||(t[36]=(0,a.Lk)("div",{class:"text-h6"},"Detail Device",-1)),I.selectedDevice?((0,a.uX)(),(0,a.CE)("div",C,[(0,a.Lk)("div",null,[t[32]||(t[32]=(0,a.Lk)("strong",null,"Device Name:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.device_name),1)]),(0,a.Lk)("div",null,[t[33]||(t[33]=(0,a.Lk)("strong",null,"MAC Address:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.mac_address),1)]),(0,a.Lk)("div",null,[t[34]||(t[34]=(0,a.Lk)("strong",null,"Topic:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedDevice.topic),1)]),(0,a.Lk)("div",null,[t[35]||(t[35]=(0,a.Lk)("strong",null,"Current Data:",-1)),(0,a.eW)(" "+(0,i.v_)(W.getTemperature(I.selectedDevice.data))+" °C ",1)]),W.hasLocation?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.bF)(J,{zoom:I.zoom,center:W.mapCenter,style:{height:"100%",width:"100%"}},{default:(0,a.k6)(()=>[(0,a.bF)(N,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"© OpenStreetMap contributors"}),(0,a.bF)(B,{"lat-lng":W.mapCenter},null,8,["lat-lng"])]),_:1},8,["zoom","center"])])):((0,a.uX)(),(0,a.CE)("div",E," Lokasi tidak tersedia (latitude/longitude kosong). "))])):(0,a.Q3)("",!0)]),_:1,__:[36]}),(0,a.bF)(P,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bo)((0,a.bF)(M,{flat:"",label:"Close",color:"white"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(R,{modelValue:I.historyDialog,"onUpdate:modelValue":t[10]||(t[10]=e=>I.historyDialog=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{class:"bg-dark text-white",style:{"min-width":"400px","max-width":"600px"}},{default:(0,a.k6)(()=>[(0,a.bF)(H,null,{default:(0,a.k6)(()=>[t[40]||(t[40]=(0,a.Lk)("div",{class:"text-h6"},"Device History Logs",-1)),I.selectedHistoryDevice?((0,a.uX)(),(0,a.CE)("div",z,[(0,a.Lk)("div",null,[t[37]||(t[37]=(0,a.Lk)("strong",null,"Device Name:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedHistoryDevice.device_name),1)]),(0,a.Lk)("div",null,[t[38]||(t[38]=(0,a.Lk)("strong",null,"MAC Address:",-1)),(0,a.eW)(" "+(0,i.v_)(I.selectedHistoryDevice.mac_address),1)]),(0,a.bF)(Z,{rows:I.deviceLogs||[],columns:I.columns,"row-key":"log_value",loading:e.loadingLogs,dense:"",flat:"",class:"bg-dark text-white q-mt-md"},null,8,["rows","columns","loading"])])):((0,a.uX)(),(0,a.CE)("div",S,t[39]||(t[39]=[(0,a.Lk)("div",null,"Loading history...",-1)])))]),_:1,__:[40]}),(0,a.bF)(P,{align:"right"},{default:(0,a.k6)(()=>[(0,a.bo)((0,a.bF)(M,{flat:"",label:"Close",color:"white"},null,512),[[ee]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,a.bF)(R,{modelValue:I.showEditDialog,"onUpdate:modelValue":t[18]||(t[18]=e=>I.showEditDialog=e),persistent:""},{default:(0,a.k6)(()=>[(0,a.bF)(Q,{style:{"min-width":"400px","max-width":"600px"},class:"bg-dark"},{default:(0,a.k6)(()=>[(0,a.bF)(H,null,{default:(0,a.k6)(()=>t[41]||(t[41]=[(0,a.Lk)("div",{class:"text-h6 text-white"},"Edit Device",-1)])),_:1,__:[41]}),(0,a.bF)(H,null,{default:(0,a.k6)(()=>[(0,a.bF)(j,{onSubmit:(0,s.D$)(W.submitEdit,["prevent"]),ref:"formRef",class:"col"},{default:(0,a.k6)(()=>[(0,a.Lk)("div",T,[(0,a.bF)(Y,{outlined:"",dense:"",modelValue:I.form.mac_address,"onUpdate:modelValue":t[11]||(t[11]=e=>I.form.mac_address=e),label:"MAC Address","label-color":"white",class:"white-outline",readonly:"","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue"]),(0,a.bF)(Y,{outlined:"",dense:"",modelValue:I.form.device_name,"onUpdate:modelValue":t[12]||(t[12]=e=>I.form.device_name=e),label:"Device Name","label-color":"white",rules:[e=>!!e||"Device name is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(K,{outlined:"",dense:"",modelValue:I.form.device_types_id,"onUpdate:modelValue":t[13]||(t[13]=e=>I.form.device_types_id=e),options:I.deviceTypes,label:"Device Type","label-color":"white",class:"white-outline text-white","input-class":"text-white",color:"white","option-label":"type_name","option-value":"id_device_types","emit-value":"","map-options":"",clearable:"",rules:[e=>null!==e||"Device type is required"],"option-class":"text-white","popup-content-class":"bg-grey-10"},null,8,["modelValue","options","rules"]),(0,a.bF)(Y,{outlined:"",dense:"",type:"number",modelValue:I.form.latitude,"onUpdate:modelValue":t[14]||(t[14]=e=>I.form.latitude=e),modelModifiers:{number:!0},label:"Latitude","label-color":"white",rules:[e=>null!==e&&void 0!==e||"Latitude is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(Y,{outlined:"",dense:"",type:"number",modelValue:I.form.longitude,"onUpdate:modelValue":t[15]||(t[15]=e=>I.form.longitude=e),modelModifiers:{number:!0},label:"Longitude","label-color":"white",rules:[e=>null!==e&&void 0!==e||"Longitude is required"],class:"white-outline","lazy-rules":"",autocomplete:"off","input-class":"text-white",color:"white"},null,8,["modelValue","rules"]),(0,a.bF)(K,{outlined:"",dense:"",modelValue:I.form.status,"onUpdate:modelValue":t[16]||(t[16]=e=>I.form.status=e),options:I.statusOptions,label:"Status","label-color":"white",class:"white-outline","input-class":"text-white",color:"white",rules:[e=>!!e||"Status is required"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),(0,a.bo)((0,a.Lk)("input",{type:"hidden","onUpdate:modelValue":t[17]||(t[17]=e=>I.form.user_id=e)},null,512),[[s.Jo,I.form.user_id]])]),(0,a.Lk)("div",$,[(0,a.bo)((0,a.bF)(M,{flat:"",label:"Cancel",color:"red",onClick:W.closeEditDialog},null,8,["onClick"]),[[ee]]),(0,a.bF)(M,{label:"Save",type:"submit",color:"green",loading:I.loading,unelevated:""},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1,__:[42,43]}))}l(310),l(6724),l(3437);var I=l(7024);const W={name:"UserDevices",components:{LMap:I.Do,LTileLayer:I.a,LMarker:I.li},data(){return{showEditDialog:!1,loading:!1,form:{mac_address:"",device_name:"",device_types_id:null,latitude:null,longitude:null,status:"",user_id:null},deviceTypes:[],statusOptions:[{label:"Offline",value:"offline"},{label:"Online",value:"online"},{label:"Maintenance",value:"maintenance"}],deviceToEdit:null,devices:[],userId:null,detailDialog:!1,historyDialog:!1,selectedDevice:null,selectedHistoryDevice:null,zoom:15,deviceLogs:[],columns:[{name:"log_value",label:"Temperature (°C)",field:"log_value",format:e=>{try{const t=JSON.parse(e.data);return void 0!==t.temperature?t.temperature+" °C":"-"}catch{return"-"}}},{name:"log_value",label:"Status",field:"log_value",format:e=>{try{const t=JSON.parse(e.data);return void 0!==t.status?t.status:"-"}catch{return"-"}}},{name:"created_at",label:"Created At (WIB)",field:"created_at",format:e=>{if(!e)return"-";try{const t=new Date(e);return new Intl.DateTimeFormat("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Jakarta"}).format(t)}catch{return e}}}]}},async mounted(){const e=JSON.parse(localStorage.getItem("user"));this.userId=e?.id_user||null,await this.fetchDevices(),await this.fetchDeviceTypes()},computed:{hasLocation(){return this.selectedDevice&&null!=this.selectedDevice.latitude&&null!=this.selectedDevice.longitude},mapCenter(){return this.hasLocation?[this.selectedDevice.latitude,this.selectedDevice.longitude]:[0,0]}},methods:{async fetchDevices(){if(this.userId)try{const e=localStorage.getItem("token"),t=await this.$api.get(`/devices/realtime/${this.userId}`,{headers:{Authorization:`Bearer ${e}`}});console.log("Debug devices response",t.data.data),this.devices=t.data.data||[]}catch(e){this.$q.notify({type:"negative",message:"Failed to load devices",position:"top"})}else this.devices=[]},confirmDeleteDevice(e,t){this.$q.dialog({title:"Konfirmasi",message:"Apakah Anda yakin ingin menghapus device ini?",cancel:!0,persistent:!0}).onOk(()=>{this.deleteDevice(e,t)})},async deleteDevice(e,t){try{const l=localStorage.getItem("token");await this.$api.delete(`/devices/${e}`,{headers:{Authorization:`Bearer ${l}`},params:{user_id:t}}),this.$q.notify({type:"positive",message:"Device berhasil dihapus"}),this.fetchDevices()}catch(e){this.$q.notify({type:"negative",message:"Gagal menghapus device"}),console.error(e)}},goToDetailPage(e){this.$router.push({name:"DEVICEDETAILS",params:{mac_address:e}})},openDetail(e){this.selectedDevice=e,this.detailDialog=!0},async openHistory(e){this.selectedHistoryDevice=e,this.historyDialog=!0,this.deviceLogs=[],this.loadingLogs=!0;try{const t=localStorage.getItem("token"),l=await this.$api.get(`/device-logs/logs/${e.mac_address}`,{headers:{Authorization:`Bearer ${t}`}});this.deviceLogs=Array.isArray(l.data.logs)?l.data.logs:[]}catch(e){console.error("Failed to load device logs",e)}finally{this.loadingLogs=!1}},getTemperature(e){if(!e||!e.data)return"-";try{const t=JSON.parse(e.data);return void 0!==t.temperature?parseFloat(t.temperature).toFixed(2):"-"}catch(e){return console.error("JSON parse error:",e),"-"}},openEditDialog(e){this.deviceToEdit=e,this.form.mac_address=e.mac_address,this.form.device_name=e.device_name,this.form.device_types_id=e.device_types_id,this.form.latitude=e.latitude,this.form.longitude=e.longitude,this.form.status=e.status,this.form.user_id=e.user_id,this.showEditDialog=!0},async submitEdit(){const e=await this.$refs.formRef.validate();if(e){this.loading=!0;try{const e=localStorage.getItem("token");await this.$api.put(`/device-user/${this.form.mac_address}`,this.form,{headers:{Authorization:`Bearer ${e}`}}),this.$q.notify({type:"positive",message:"Device updated successfully"}),this.closeEditDialog()}catch(e){e.response&&e.response.data&&e.response.data.message?this.$q.notify({type:"negative",message:e.response.data.message}):this.$q.notify({type:"negative",message:"Failed to update device."}),console.error(e)}finally{this.loading=!1}}},closeEditDialog(){this.showEditDialog=!1,this.$refs.formRef.resetValidation&&this.$refs.formRef.resetValidation()},async fetchDeviceTypes(){try{const e=localStorage.getItem("token"),t=await this.$api.get("/device-types",{headers:{Authorization:`Bearer ${e}`}});this.deviceTypes=(t.data.deviceTypes||[]).map(e=>({...e,type_name:e.type_name||e.name})),this.deviceTypes.length>0&&!this.form.device_types_id&&(this.form.device_types_id=this.deviceTypes[0].id_device_types)}catch(e){console.error("Failed to fetch device types",e),this.deviceTypes=[]}}}};var M=l(2807),Q=l(7716),X=l(3316),O=l(1693),N=l(3954),B=l(492),J=l(2156),H=l(4189),P=l(2669),R=l(528),Y=l(9200),K=l(9270),j=l(5801),G=l(8672),Z=l(8582),ee=l.n(Z);const te=(0,M.A)(W,[["render",U]]),le=te;ee()(W,"components",{QPage:Q.A,QCard:X.A,QBtn:O.A,QBadge:N.A,QIcon:B.A,QDialog:J.A,QCardSection:H.A,QCardActions:P.A,QTable:R.A,QForm:Y.A,QInput:K.A,QSelect:j.A}),ee()(W,"directives",{ClosePopup:G.A})}}]);